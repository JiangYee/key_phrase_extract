#! /user/bin/evn python
# -*- coding:utf8 -*-

import  time, datetime
from ir.config import Config


class Search(object):
    def __init__(self):
        print("Searching ...")

    @staticmethod
    def search_by_abstract(abstract, top_n, config):
        q = {
            "query": {
                "multi_match": {
                    "query": abstract,
                    "fields": ["abstract"],
                    "fuzziness": "AUTO"
                }
            }
        }

        count = 0
        while count < top_n:
            try:
                res = config.es.search(index=config.index_name, doc_type=config.doc_type, body=q, request_timeout=30,
                                       size=top_n)
                topn = res['hits']['hits']
                count = 0
                result = []
                for data in topn:
                    if count < top_n:
                        result.append((data['_id'], data['_source']['abstract'], data['_source']['keywords'],
                                       data['_source']['rake_extract']))
                        count += 1
                return result
            except Exception as e:
                print(e)
                print("Try again!")
                count += 1
                continue

        print("ReadTimeOutError may not be covered!")
        return []


def main():
    start_time = time.time()
    config = Config()
    search = Search()
    # abstract = "virtually enhancing the perception of user actions. This paper proposes using virtual reality to " \
    #            "enhance the perception of actions by distant users on a shared application. Here, distance may refer " \
    #            "either to space ( e.g. in a remote synchronous collaboration) or time ( e.g. during playback of " \
    #            "recorded actions). Our approach consists in immersing the application in a virtual inhabited 3D space " \
    #            "and mimicking user actions by animating avatars. We illustrate this approach with two applications, " \
    #            "the one for remote collaboration on a shared application and the other to playback recorded sequences " \
    #            "of user actions. We suggest this could be a low cost enhancement for telepresence."
    # abstract = 'modeling 3d facial expressions using geometry videos. The significant advances in developing high ' \
    #            'speed shape acquisition devices make it possible to capture the moving and deforming objects at video' \
    #            ' speeds. However, due to its complicated nature, it is technically challenging to effectively model' \
    #            ' and store the captured motion data. In this paper, we present a set of algorithms to construct ' \
    #            'geometry videos for 3D facial expressions, including hole filling, geodesic based face segmentation, ' \
    #            'and expression invariant parametrization. Our algorithms are efficient and robust, and can guarantee ' \
    #            'the exact correspondence of the salient features (eyes, mouth and nose). Geometry video naturally ' \
    #            'bridges the 3D motion data and 2D video, and provides a way to borrow the well studied video' \
    #            ' processing techniques to motion data processing. With our proposed intra frame prediction scheme ' \
    #            'based on H.264/AVC, we are able to compress the geometry videos into a very compact size while' \
    #            ' maintaining the video quality. Our experimental results on real world datasets demonstrate that ' \
    #            'geometry video is effective for modeling the high resolution 3D expression data.'
    abstract = 'Fortran programs for the time dependent Gross Pitaevskii equation in a fully anisotropic trap ?. Here we develop simple numerical algorithms for both stationary and non stationary solutions of the time dependent Gross Pitaevskii (GP) equation describing the properties of Bose Einstein condensates at ultra low temperatures. In particular, we consider algorithms involving real  and imaginary time propagation based on a split step Crank Nicolson method. In a one space variable form of the GP equation we consider the one dimensional, two dimensional circularly symmetric, and the three dimensional spherically symmetric harmonic oscillator traps. In the two space variable form we consider the GP equation in two dimensional anisotropic and three dimensional axially symmetric traps. The fully anisotropic three dimensional GP equation is also considered. Numerical results for the chemical potential and root mean square size of stationary states are reported using imaginary time propagation programs for all the cases and compared with previously obtained results. Also presented are numerical results of non stationary oscillation for different trap symmetries using real time propagation programs. A set of convenient working codes developed in Fortran 77 are also provided for all these cases (twelve programs in all). In the case of two or three space variables, Fortran 90/95 versions provide some simplification over the Fortran 77 programs, and these programs are also included (six programs in all). Program title: (i) imagetime1d, (ii) imagetime2d, (iii) imagetime3d, (iv) imagetimecir, (v) imagetimesph, (vi) imagetimeaxial, (vii) realtime1d, (viii) realtime2d, (ix) realtime3d, (x) realtimecir, (xi) realtimesph, (xii) realtimeaxial Catalogue identifier: AEDU_v1_0 Program summary URL:http://cpc.cs.qub.ac.uk/summaries/AEDU_v1_0.html Program obtainable from: CPC Program Library, Queen s University, Belfast, N. Ireland Licensing provisions: Standard CPC licence, http://cpc.cs.qub.ac.uk/licence/licence.html No. of lines in distributed program, including test data, etc.: 122?907 No. of bytes in distributed program, including test data, etc.: 609?662 Distribution format: tar.gz Programming language: FORTRAN 77 and Fortran 90/95 Computer: PC Operating system: Linux, Unix RAM: 1 GByte (i, iv, v), 2 GByte (ii, vi, vii, x, xi), 4 GByte (iii, viii, xii), 8 GByte (ix) Classification: 2.9, 4.3, 4.12 Nature of problem: These programs are designed to solve the time dependent Gross Pitaevskii nonlinear partial differential equation in one , two  or three space dimensions with a harmonic, circularly symmetric, spherically symmetric, axially symmetric or anisotropic trap. The Gross Pitaevskii equation describes the properties of a dilute trapped Bose Einstein condensate. Solution method: The time dependent Gross Pitaevskii equation is solved by the split step Crank Nicolson method by discretizing in space and time. The discretized equation is then solved by propagation, in either imaginary or real time, over small time steps. The method yields the solution of stationary and/or non stationary problems. Additional comments: This package consists of 12 programs, see  Program title , above. FORTRAN77 versions are provided for each of the 12 and, in addition, Fortran 90/95 versions are included for ii, iii, vi, viii, ix, xii. For the particular purpose of each program please see the below. Running time: Minutes on a medium PC (i, iv, v, vii, x, xi), a few hours on a medium PC (ii, vi, viii, xii), days on a medium PC (iii, ix). Title of program: imagtime1d.F Title of electronic file: imagtime1d.tar.gz Catalogue identifier: Program summary URL: Program obtainable from: CPC Program Library, Queen s University of Belfast, N. Ireland Distribution format: tar.gz Computers: PC/Linux, workstation/UNIX Maximum RAM memory: 1 GByte Programming language used: Fortran 77 Typical running time: Minutes on a medium PC Unusual features: None Nature of physical problem: This program is designed to solve the time dependent Gross Pitaevskii nonlinear partial differential equation in one space dimension with a harmonic trap. The Gross Pitaevskii equation describes the properties of a dilute trapped Bose Einstein condensate. Method of solution: The time dependent Gross Pitaevskii equation is solved by the split step Crank Nicolson method by discretizing in space and time. The discretized equation is then solved by propagation in imaginary time over small time steps. The method yields the solution of stationary problems. Title of program: imagtimecir.F Title of electronic file: imagtimecir.tar.gz Catalogue identifier: Program summary URL: Program obtainable from: CPC Program Library, Queen s University of Belfast, N. Ireland Distribution format: tar.gz Computers: PC/Linux, workstation/UNIX Maximum RAM memory: 1 GByte Programming language used: Fortran 77 Typical running time: Minutes on a medium PC Unusual features: None Nature of physical problem: This program is designed to solve the time dependent Gross Pitaevskii nonlinear partial differential equation in two space dimensions with a circularly symmetric trap. The Gross Pitaevskii equation describes the properties of a dilute trapped Bose Einstein condensate. Method of solution: The time dependent Gross Pitaevskii equation is solved by the split step Crank Nicolson method by discretizing in space and time. The discretized equation is then solved by propagation in imaginary time over small time steps. The method yields the solution of stationary problems. Title of program: imagtimesph.F Title of electronic file: imagtimesph.tar.gz Catalogue identifier: Program summary URL: Program obtainable from: CPC Program Library, Queen s University of Belfast, N. Ireland Distribution format: tar.gz Computers: PC/Linux, workstation/UNIX Maximum RAM memory: 1 GByte Programming language used: Fortran 77 Typical running time: Minutes on a medium PC Unusual features: None Nature of physical problem: This program is designed to solve the time dependent Gross Pitaevskii nonlinear partial differential equation in three space dimensions with a spherically symmetric trap. The Gross Pitaevskii equation describes the properties of a dilute trapped Bose Einstein condensate. Method of solution: The time dependent Gross Pitaevskii equation is solved by the split step Crank Nicolson method by discretizing in space and time. The discretized equation is then solved by propagation in imaginary time over small time steps. The method yields the solution of stationary problems. Title of program: realtime1d.F Title of electronic file: realtime1d.tar.gz Catalogue identifier: Program summary URL: Program obtainable from: CPC Program Library, Queen s University of Belfast, N. Ireland Distribution format: tar.gz Computers: PC/Linux, workstation/UNIX Maximum RAM memory: 2 GByte Programming language used: Fortran 77 Typical running time: Minutes on a medium PC Unusual features: None Nature of physical problem: This program is designed to solve the time dependent Gross Pitaevskii nonlinear partial differential equation in one space dimension with a harmonic trap. The Gross Pitaevskii equation describes the properties of a dilute trapped Bose Einstein condensate. Method of solution: The time dependent Gross Pitaevskii equation is solved by the split step Crank Nicolson method by discretizing in space and time. The discretized equation is then solved by propagation in real time over small time steps. The method yields the solution of stationary and non stationary problems. Title of program: realtimecir.F Title of electronic file: realtimecir.tar.gz Catalogue identifier: Program summary URL: Program obtainable from: CPC Program Library, Queen s University of Belfast, N. Ireland Distribution format: tar.gz Computers: PC/Linux, workstation/UNIX Maximum RAM memory: 2 GByte Programming language used: Fortran 77 Typical running time: Minutes on a medium PC Unusual features: None Nature of physical problem: This program is designed to solve the time dependent Gross Pitaevskii nonlinear partial differential equation in two space dimensions with a circularly symmetric trap. The Gross Pitaevskii equation describes the properties of a dilute trapped Bose Einstein condensate. Method of solution: The time dependent Gross Pitaevskii equation is solved by the split step Crank Nicolson method by discretizing in space and time. The discretized equation is then solved by propagation in real time over small time steps. The method yields the solution of stationary and non stationary problems. Title of program: realtimesph.F Title of electronic file: realtimesph.tar.gz Catalogue identifier: Program summary URL: Program obtainable from: CPC Program Library, Queen s University of Belfast, N. Ireland Distribution format: tar.gz Computers: PC/Linux, workstation/UNIX Maximum RAM memory: 2 GByte Programming language used: Fortran 77 Typical running time: Minutes on a medium PC Unusual features: None Nature of physical problem: This program is designed to solve the time dependent Gross Pitaevskii nonlinear partial differential equation in three space dimensions with a spherically symmetric trap. The Gross Pitaevskii equation describes the properties of a dilute trapped Bose Einstein condensate. Method of solution: The time dependent Gross Pitaevskii equation is solved by the split step Crank Nicolson method by discretizing in space and time. The discretized equation is then solved by propagation in real time over small time steps. The method yields the solution of stationary and non stationary problems. Title of programs: imagtimeaxial.F and imagtimeaxial.f90 Title of electronic file: imagtimeaxial.tar.gz Catalogue identifier: Program summary URL: Program obtainable from: CPC Program Library, Queen s University of Belfast, N. Ireland Distribution format: tar.gz Computers: PC/Linux, workstation/UNIX Maximum RAM memory: 2 GByte Programming language used: Fortran 77 and Fortran 90 Typical running time: Few hours on a medium PC Unusual features: None Nature of physical problem: This program is designed to solve the time dependent Gross Pitaevskii nonlinear partial differential equation in three space dimensions with an axially symmetric trap. The Gross Pitaevskii equation describes the properties of a dilute trapped Bose Einstein condensate. Method of solution: The time dependent Gross Pitaevskii equation is solved by the split step Crank Nicolson method by discretizing in space and time. The discretized equation is then solved by propagation in imaginary time over small time steps. The method yields the solution of stationary problems. Title of program: imagtime2d.F and imagtime2d.f90 Title of electronic file: imagtime2d.tar.gz Catalogue identifier: Program summary URL: Program obtainable from: CPC Program Library, Queen s University of Belfast, N. Ireland Distribution format: tar.gz Computers: PC/Linux, workstation/UNIX Maximum RAM memory: 2 GByte Programming language used: Fortran 77 and Fortran 90 Typical running time: Few hours on a medium PC Unusual features: None Nature of physical problem: This program is designed to solve the time dependent Gross Pitaevskii nonlinear partial differential equation in two space dimensions with an anisotropic trap. The Gross Pitaevskii equation describes the properties of a dilute trapped Bose Einstein condensate. Method of solution: The time dependent Gross Pitaevskii equation is solved by the split step Crank Nicolson method by discretizing in space and time. The discretized equation is then solved by propagation in imaginary time over small time steps. The method yields the solution of stationary problems. Title of program: realtimeaxial.F and realtimeaxial.f90 Title of electronic file: realtimeaxial.tar.gz Catalogue identifier: Program summary URL: Program obtainable from: CPC Program Library, Queen s University of Belfast, N. Ireland Distribution format: tar.gz Computers: PC/Linux, workstation/UNIX Maximum RAM memory: 4 GByte Programming language used: Fortran 77 and Fortran 90 Typical running time Hours on a medium PC Unusual features: None Nature of physical problem: This program is designed to solve the time dependent Gross Pitaevskii nonlinear partial differential equation in three space dimensions with an axially symmetric trap. The Gross Pitaevskii equation describes the properties of a dilute trapped Bose Einstein condensate. Method of solution: The time dependent Gross Pitaevskii equation is solved by the split step Crank Nicolson method by discretizing in space and time. The discretized equation is then solved by propagation in real time over small time steps. The method yields the solution of stationary and non stationary problems. Title of program: realtime2d.F and realtime2d.f90 Title of electronic file: realtime2d.tar.gz Catalogue identifier: Program summary URL: Program obtainable from: CPC Program Library, Queen s University of Belfast, N. Ireland Distribution format: tar.gz Computers: PC/Linux, workstation/UNIX Maximum RAM memory: 4 GByte Programming language used: Fortran 77 and Fortran 90 Typical running time: Hours on a medium PC Unusual features: None Nature of physical problem: This program is designed to solve the time dependent Gross Pitaevskii nonlinear partial differential equation in two space dimensions with an anisotropic trap. The Gross Pitaevskii equation describes the properties of a dilute trapped Bose Einstein condensate. Method of solution: The time dependent Gross Pitaevskii equation is solved by the split step Crank Nicolson method by discretizing in space and time. The discretized equation is then solved by propagation in real time over small time steps. The method yields the solution of stationary and non stationary problems. Title of program: imagtime3d.F and imagtime3d.f90 Title of electronic file: imagtime3d.tar.gz Catalogue identifier: Program summary URL: Program obtainable from: CPC Program Library, Queen s University of Belfast, N. Ireland Distribution format: tar.gz Computers: PC/Linux, workstation/UNIX Maximum RAM memory: 4 GByte Programming language used: Fortran 77 and Fortran 90 Typical running time: Few days on a medium PC Unusual features: None Nature of physical problem: This program is designed to solve the time dependent Gross Pitaevskii nonlinear partial differential equation in three space dimensions with an anisotropic trap. The Gross Pitaevskii equation describes the properties of a dilute trapped Bose Einstein condensate. Method of solution: The time dependent Gross Pitaevskii equation is solved by the split step Crank Nicolson method by discretizing in space and time. The discretized equation is then solved by propagation in imaginary time over small time steps. The method yields the solution of stationary problems. Title of program: realtime3d.F and realtime3d.f90 Title of electronic file: realtime3d.tar.gz Catalogue identifier: Program summary URL: Program obtainable from: CPC Program Library, Queen s University of Belfast, N. Ireland Distribution format: tar.gz Computers: PC/Linux, workstation/UNIX Maximum Ram Memory: 8 GByte Programming language used: Fortran 77 and Fortran 90 Typical running time: Days on a medium PC Unusual features: None Nature of physical problem: This program is designed to solve the time dependent Gross Pitaevskii nonlinear partial differential equation in three space dimensions with an anisotropic trap. The Gross Pitaevskii equation describes the properties of a dilute trapped Bose Einstein condensate. Method of solution: The time dependent Gross Pitaevskii equation is solved by the split step Crank Nicolson method by discretizing in space and time. The discretized equation is then solved by propagation in real time over small time steps. The method yields the solution of stationary and non stationary problems.'
    result = search.search_by_abstract(abstract, 500, config)
    for data in result:
    #     print(data[0], data[1], data[2])
    #     print(data[:2])
        print(data)
    # print(result)
    end_time = time.time()
    time_dif = datetime.timedelta(seconds=int(round(end_time - start_time)))
    print(time_dif)

if __name__ == '__main__':
    main()
